{% extends "layout.html" %}
{% block content %}
<div class="bg-gradient-to-br from-gray-50 via-white to-gray-100 min-h-screen py-10 px-6">
  <div class="max-w-6xl mx-auto bg-white rounded-2xl shadow-2xl p-8 transition-all duration-300 hover:shadow-[0_0_30px_-10px_rgba(0,0,0,0.3)]">
    
    <!-- Header -->
    <div class="flex flex-col sm:flex-row items-center justify-between gap-4 border-b pb-4">
      <div>
        <h2 class="text-3xl font-bold text-gray-800 tracking-tight">ğŸ¯ Internship Matching Results</h2>
        <p class="text-sm text-gray-500 mt-1">View candidate-internship matches, scores, and manage exports.</p>
      </div>
      <div class="flex gap-3">
        <form method="post">
          <button class="bg-green-600 hover:bg-green-700 transition-all duration-200 text-white font-medium py-2 px-5 rounded-lg shadow-md hover:shadow-lg">
            ğŸ”„ Re-run Matching
          </button>
        </form>
        <a href="{{ url_for('export_matches') }}" 
           class="bg-gray-800 hover:bg-gray-900 transition-all duration-200 text-white font-medium py-2 px-5 rounded-lg shadow-md hover:shadow-lg">
           ğŸ“¤ Export CSV
        </a>
      </div>
    </div>

    <!-- Stats Section -->
    <div class="mt-8 grid grid-cols-1 sm:grid-cols-3 gap-4">
      <div class="p-5 bg-green-50 border border-green-100 rounded-xl text-center shadow hover:scale-105 transition">
        <h3 class="text-sm font-semibold text-gray-500 uppercase">Total Matches</h3>
        <p class="text-3xl font-bold text-green-700 mt-1">{{ matches|length }}</p>
      </div>
      <div class="p-5 bg-blue-50 border border-blue-100 rounded-xl text-center shadow hover:scale-105 transition">
        <h3 class="text-sm font-semibold text-gray-500 uppercase">Average Score</h3>
        <p class="text-3xl font-bold text-blue-700 mt-1">
          {% if matches|length > 0 %}
          {{ (matches | map(attribute='score') | sum / matches|length) | round(2) }}
          {% else %}0{% endif %}
        </p>
      </div>
      <div class="p-5 bg-purple-50 border border-purple-100 rounded-xl text-center shadow hover:scale-105 transition">
        <h3 class="text-sm font-semibold text-gray-500 uppercase">Last Updated</h3>
        <p class="text-lg font-medium text-purple-700 mt-1">{{ last_updated or "N/A" }}</p>
      </div>
    </div>

    <!-- Search & Filter -->
    <div class="mt-6 flex flex-col sm:flex-row gap-3 sm:items-center sm:justify-between">
      <div class="flex items-center gap-2 w-full sm:w-auto">
        <input id="searchInput" type="text" placeholder="ğŸ” Search candidates or internships..."
               class="w-full sm:w-80 px-4 py-2 border rounded-lg focus:ring-2 focus:ring-green-400 outline-none transition">
      </div>
    </div>

    <!-- Table Section -->
    <div class="mt-6 overflow-x-auto">
      <table class="min-w-full text-sm border border-gray-200 rounded-xl overflow-hidden">
        <thead class="bg-gray-100 text-gray-700 uppercase text-xs font-semibold">
          <tr>
            <th class="px-6 py-3 text-left">Candidate</th>
            <th class="px-6 py-3 text-left">Internship</th>
            <th class="px-6 py-3 text-center">Match Score</th>
          </tr>
        </thead>
        <tbody id="matchTable" class="bg-white divide-y divide-gray-100">
          {% for m in matches %}
          <tr class="hover:bg-green-50 transition duration-200">
            <td class="px-6 py-3 font-medium text-gray-800">{{ m.candidate.name }}</td>
            <td class="px-6 py-3 text-gray-700">{{ m.internship.title }}</td>
            <td class="px-6 py-3 text-center font-semibold text-green-700">{{ m.score }}</td>
          </tr>
          {% else %}
          <tr>
            <td colspan="3" class="px-6 py-6 text-center text-gray-500">
              ğŸ˜• No matches found yet â€” click â€œRe-run Matchingâ€ to generate results.
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>

<!-- Simple JS Search Filter -->
<script>
  const searchInput = document.getElementById('searchInput');
  const rows = document.querySelectorAll('#matchTable tr');

  searchInput.addEventListener('input', () => {
    const query = searchInput.value.toLowerCase();
    rows.forEach(row => {
      const text = row.textContent.toLowerCase();
      row.style.display = text.includes(query) ? '' : 'none';
    });
  });
</script>
{% endblock %}
